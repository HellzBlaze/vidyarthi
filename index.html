<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vidyarthi - Unified Planner</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-soft: #dbeafe;
            --text: #1e293b;
            --text-light: #64748b;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --danger: #ef4444;
            --success: #10b981;
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
            --primary-soft: #1e3a8a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body { background-color: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; transition: background 0.3s; }

        /* --- SIDEBAR --- */
        .sidebar { 
            width: 250px; background: var(--card-bg); padding: 25px; display: flex; flex-direction: column; 
            border-right: 1px solid var(--border); z-index: 100;
        }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        
        .nav-btn {
            background: none; border: none; width: 100%; padding: 12px; text-align: left; cursor: pointer; 
            border-radius: 12px; color: var(--text-light); font-weight: 600; font-size: 1rem; 
            margin-bottom: 5px; display: flex; align-items: center; gap: 12px; transition: 0.2s;
        }
        .nav-btn:hover { background: var(--border); color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; padding: 20px 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        h2 { font-size: 1.8rem; font-weight: 800; }

        /* --- CARDS --- */
        .section { display: none; animation: fade 0.2s ease; padding-bottom: 80px; }
        .section.active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* --- TASK LIST --- */
        .input-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        input { padding: 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--bg); color: var(--text); outline: none; flex: 1; font-size: 1rem; }
        input:focus { border-color: var(--primary); background: var(--card-bg); }
        
        .btn { padding: 0 20px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        .task-group { margin-bottom: 25px; }
        .group-title { font-size: 0.85rem; font-weight: 700; text-transform: uppercase; color: var(--text-light); margin-bottom: 10px; letter-spacing: 0.5px; }
        .task-item { 
            display: flex; align-items: center; padding: 14px; background: var(--card-bg); 
            border: 1px solid var(--border); border-radius: 12px; margin-bottom: 8px; transition: 0.2s;
        }
        .task-check { 
            width: 22px; height: 22px; border-radius: 6px; border: 2px solid var(--text-light); 
            margin-right: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; 
        }
        .task-check.checked { background: var(--success); border-color: var(--success); color: white; }
        
        /* --- EDITABLE TIMETABLE --- */
        .tt-wrapper { overflow-x: auto; border-radius: 12px; border: 1px solid var(--border); }
        .tt-grid { display: grid; grid-template-columns: 70px repeat(5, minmax(100px, 1fr)); min-width: 600px; }
        .tt-cell { 
            padding: 10px; border-bottom: 1px solid var(--border); border-right: 1px solid var(--border); 
            background: var(--card-bg); min-height: 50px; display: flex; align-items: center; justify-content: center;
        }
        .tt-head { font-weight: 700; background: var(--bg); color: var(--text-light); font-size: 0.9rem; }
        /* The Magic Input for Timetable */
        .tt-input { 
            width: 100%; height: 100%; border: none; background: transparent; 
            text-align: center; font-size: 0.9rem; color: var(--text); padding: 5px; font-weight: 500;
        }
        .tt-input:focus { background: var(--primary-soft); color: var(--primary); outline: none; border-radius: 4px; }

        /* --- HABITS --- */
        .habit-row { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; }
        .habit-row:last-child { border-bottom: none; }
        .habit-row.done .habit-title { text-decoration: line-through; color: var(--text-light); opacity: 0.7; }

        /* --- MOBILE --- */
        @media (max-width: 768px) {
            body { flex-direction: column; height: 100vh; }
            .sidebar { 
                position: fixed; bottom: 0; left: 0; width: 100%; height: 65px;
                flex-direction: row; padding: 0; border-top: 1px solid var(--border); border-right: none;
                justify-content: space-around; background: var(--card-bg);
            }
            .sidebar .logo { display: none; }
            .nav-btn { flex-direction: column; gap: 2px; padding: 5px; font-size: 0.7rem; justify-content: center; height: 100%; border-radius: 0; }
            .nav-btn span:first-child { font-size: 1.4rem; } 
            .nav-btn.active { color: var(--primary); background: transparent; }
            .main-content { padding: 15px; margin-bottom: 65px; }
            .grid-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">üéì Vidyarthi</div>
        <button class="nav-btn active" onclick="nav('home')"><span>üè†</span> <span>Home</span></button>
        <button class="nav-btn" onclick="nav('tasks')"><span>üìù</span> <span>Tasks</span></button>
        <button class="nav-btn" onclick="nav('timetable')"><span>üìÖ</span> <span>Timetable</span></button>
        <button class="nav-btn" onclick="nav('habits')"><span>üî•</span> <span>Habits</span></button>
        <button class="nav-btn" onclick="nav('focus')"><span>üçÖ</span> <span>Focus</span></button>
    </nav>

    <main class="main-content">
        
        <div class="header">
            <div>
                <h2 id="page-title">Dashboard</h2>
                <div style="color: var(--text-light); font-size: 0.9rem;" id="date-display">...</div>
            </div>
            <div style="cursor: pointer;" onclick="toggleTheme()">üåó</div>
        </div>

        <section id="home" class="section active">
            <div class="grid-2">
                <div class="card" style="background: linear-gradient(135deg, var(--primary), #3b82f6); color: white; border: none;">
                    <div style="opacity: 0.9; margin-bottom: 5px;">Tasks Remaining</div>
                    <div style="font-size: 3rem; font-weight: 800; line-height: 1;" id="dash-count">0</div>
                    <div style="margin-top: 10px; font-size: 0.9rem;">Keep it up!</div>
                </div>

                <div class="card">
                    <div style="font-weight: 700; margin-bottom: 10px; color: var(--text-light);">QUICK NOTES</div>
                    <textarea id="quick-notes" style="width: 100%; height: 80px; border: none; background: transparent; resize: none; color: var(--text); outline: none;" placeholder="Type thoughts here..."></textarea>
                </div>
            </div>
            
            <div class="card">
                <div style="font-weight: 700; margin-bottom: 15px;">TODAY'S AGENDA</div>
                <div id="dash-list"></div>
            </div>
        </section>

        <section id="tasks" class="section">
            <div class="card input-bar">
                <input type="text" id="task-input" placeholder="Add a new task...">
                <input type="date" id="task-date" style="max-width: 130px;">
                <button class="btn" onclick="addTask()">Add</button>
            </div>
            <div id="task-container"></div>
        </section>

        <section id="timetable" class="section">
            <div class="card">
                <div style="margin-bottom: 15px; color: var(--text-light); font-size: 0.9rem;">
                    üí° Tip: Click any cell to type your subject. It saves automatically.
                </div>
                <div class="tt-wrapper">
                    <div class="tt-grid" id="tt-grid">
                        </div>
                </div>
            </div>
        </section>

        <section id="habits" class="section">
            <div class="card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h3>Daily Habits</h3>
                    <button class="btn" onclick="addHabit()" style="height: 30px; font-size: 1.2rem;">+</button>
                </div>
                <div id="habit-list"></div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="resetApp()" style="background: none; border: 1px solid var(--danger); color: var(--danger); padding: 10px 20px; border-radius: 8px; cursor: pointer;">Reset All Data</button>
            </div>
        </section>

        <section id="focus" class="section">
            <div class="card" style="text-align: center; padding: 50px 20px;">
                <h3 style="color: var(--text-light);">FOCUS TIMER</h3>
                <div style="font-size: 5rem; font-weight: 800; color: var(--primary); margin: 20px 0; font-variant-numeric: tabular-nums;" id="timer-display">25:00</div>
                <div style="display: flex; justify-content: center; gap: 10px;">
                    <button class="btn" onclick="toggleTimer()" id="timer-btn">Start</button>
                    <button class="btn" style="background: var(--border); color: var(--text);" onclick="resetTimer()">Reset</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- DATA STORE ---
        let tasks = JSON.parse(localStorage.getItem('vTasks')) || [];
        let habits = JSON.parse(localStorage.getItem('vHabits')) || [
            { id: 1, title: 'Drink Water', last: '' },
            { id: 2, title: 'Read Book', last: '' }
        ];
        // Timetable Data: simple object { "row-col": "Value" }
        let ttData = JSON.parse(localStorage.getItem('vTimetable')) || {};

        // --- INIT ---
        const todayStr = new Date().toISOString().split('T')[0];
        document.getElementById('task-date').value = todayStr;
        document.getElementById('date-display').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        
        // Notes autosave
        const noteEl = document.getElementById('quick-notes');
        noteEl.value = localStorage.getItem('vNotes') || '';
        noteEl.addEventListener('input', () => localStorage.setItem('vNotes', noteEl.value));

        // Dark Mode Check
        if(localStorage.getItem('vTheme') === 'dark') document.body.setAttribute('data-theme', 'dark');

        renderAll();

        // --- NAVIGATION ---
        function nav(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // Highlight button
            Array.from(document.querySelectorAll('.nav-btn')).find(b => b.onclick.toString().includes(id)).classList.add('active');
            
            // Title
            const titles = {home: 'Dashboard', tasks: 'All Tasks', timetable: 'Schedule', habits: 'Habits', focus: 'Focus Mode'};
            document.getElementById('page-title').innerText = titles[id];
        }

        // --- TASKS LOGIC (Unified) ---
        function addTask() {
            const txt = document.getElementById('task-input').value;
            const date = document.getElementById('task-date').value || todayStr;
            if(!txt) return;
            
            tasks.push({ id: Date.now(), title: txt, date: date, done: false });
            saveTasks();
            document.getElementById('task-input').value = '';
        }

        function toggleTask(id) {
            const t = tasks.find(x => x.id === id);
            if(t) { t.done = !t.done; saveTasks(); }
        }

        function deleteTask(id) {
            if(confirm('Delete?')) {
                tasks = tasks.filter(x => x.id !== id);
                saveTasks();
            }
        }

        function saveTasks() {
            localStorage.setItem('vTasks', JSON.stringify(tasks));
            renderTasks();
        }

        function renderTasks() {
            const container = document.getElementById('task-container');
            const dashList = document.getElementById('dash-list');
            container.innerHTML = '';
            dashList.innerHTML = '';
            
            let pending = 0;
            
            // Sort by Date
            tasks.sort((a, b) => a.date.localeCompare(b.date));

            // Groups
            const groups = { overdue: [], today: [], upcoming: [], done: [] };

            tasks.forEach(t => {
                if(t.done) {
                    groups.done.push(t);
                } else {
                    pending++;
                    if(t.date < todayStr) groups.overdue.push(t);
                    else if(t.date === todayStr) groups.today.push(t);
                    else groups.upcoming.push(t);
                }
            });

            document.getElementById('dash-count').innerText = pending;

            // HTML Generator
            const mkHtml = (t) => `
                <div class="task-item" style="opacity: ${t.done ? 0.5 : 1}">
                    <div class="task-check ${t.done ? 'checked' : ''}" onclick="toggleTask(${t.id})">${t.done ? '‚úì' : ''}</div>
                    <div style="flex:1;">
                        <div style="font-weight: 500; text-decoration: ${t.done ? 'line-through' : 'none'}">${t.title}</div>
                        <div style="font-size: 0.8rem; color: var(--text-light);">üìÖ ${t.date}</div>
                    </div>
                    <button onclick="deleteTask(${t.id})" style="background:none; border:none; color: var(--text-light); font-size: 1.2rem;">&times;</button>
                </div>
            `;

            // Render Groups
            const renderGroup = (title, list, target) => {
                if(list.length > 0) {
                    target.innerHTML += `<div class="group-title">${title}</div>`;
                    list.forEach(t => target.innerHTML += mkHtml(t));
                }
            };

            renderGroup('‚ö†Ô∏è Overdue', groups.overdue, container);
            renderGroup('üî• Today', groups.today, container);
            renderGroup('üìÖ Upcoming', groups.upcoming, container);
            renderGroup('‚úÖ Completed', groups.done, container);

            // Dashboard only shows Today & Overdue
            renderGroup('‚ö†Ô∏è Overdue', groups.overdue, dashList);
            renderGroup('üî• Today', groups.today, dashList);
            if(dashList.innerHTML === '') dashList.innerHTML = '<div style="color:var(--text-light); padding:10px;">No tasks due today. Enjoy!</div>';
        }

        // --- TIMETABLE LOGIC (Editable) ---
        function renderTimetable() {
            const grid = document.getElementById('tt-grid');
            grid.innerHTML = '';
            
            const days = ['Time', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            const times = ['09:00', '10:00', '11:00', '12:00', '01:00']; // customizable

            // Headers
            days.forEach(d => grid.innerHTML += `<div class="tt-cell tt-head">${d}</div>`);

            // Rows
            times.forEach((time, rIndex) => {
                // Time Column
                grid.innerHTML += `<div class="tt-cell tt-head">${time}</div>`;
                
                // Day Columns
                for(let cIndex = 0; cIndex < 5; cIndex++) {
                    const key = `r${rIndex}-c${cIndex}`;
                    const val = ttData[key] || '';
                    grid.innerHTML += `
                        <div class="tt-cell">
                            <input class="tt-input" value="${val}" onchange="saveTT('${key}', this.value)" placeholder="-">
                        </div>`;
                }
            });
        }

        function saveTT(key, val) {
            ttData[key] = val;
            localStorage.setItem('vTimetable', JSON.stringify(ttData));
        }

        // --- HABITS LOGIC ---
        function renderHabits() {
            const list = document.getElementById('habit-list');
            list.innerHTML = '';
            habits.forEach(h => {
                const isDone = h.last === todayStr;
                list.innerHTML += `
                    <div class="habit-row ${isDone ? 'done' : ''}" onclick="toggleHabit(${h.id})">
                        <div class="task-check ${isDone ? 'checked' : ''}">${isDone ? '‚úì' : ''}</div>
                        <div class="habit-title" style="flex:1; font-weight:500;">${h.title}</div>
                        <div style="font-size:0.8rem; color:var(--text-light);">${isDone ? 'Done today' : 'Tap to mark'}</div>
                    </div>`;
            });
        }

        function toggleHabit(id) {
            const h = habits.find(x => x.id === id);
            h.last = (h.last === todayStr) ? '' : todayStr;
            localStorage.setItem('vHabits', JSON.stringify(habits));
            renderHabits();
        }

        function addHabit() {
            const t = prompt("New Habit Name:");
            if(t) {
                habits.push({ id: Date.now(), title: t, last: '' });
                localStorage.setItem('vHabits', JSON.stringify(habits));
                renderHabits();
            }
        }

        // --- TIMER ---
        let timer = null;
        let timeLeft = 1500;
        function toggleTimer() {
            if(timer) {
                clearInterval(timer); timer = null;
                document.getElementById('timer-btn').innerText = "Start";
            } else {
                timer = setInterval(() => {
                    timeLeft--;
                    const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
                    const s = (timeLeft%60).toString().padStart(2,'0');
                    document.getElementById('timer-display').innerText = `${m}:${s}`;
                    if(timeLeft <= 0) resetTimer();
                }, 1000);
                document.getElementById('timer-btn').innerText = "Pause";
            }
        }
        function resetTimer() {
            clearInterval(timer); timer = null; timeLeft = 1500;
            document.getElementById('timer-display').innerText = "25:00";
            document.getElementById('timer-btn').innerText = "Start";
        }

        // --- SETTINGS ---
        function toggleTheme() {
            if(document.body.getAttribute('data-theme') === 'dark') {
                document.body.removeAttribute('data-theme');
                localStorage.setItem('vTheme', 'light');
            } else {
                document.body.setAttribute('data-theme', 'dark');
                localStorage.setItem('vTheme', 'dark');
            }
        }

        function resetApp() {
            if(confirm("Wipe all data?")) { localStorage.clear(); location.reload(); }
        }

        function renderAll() {
            renderTasks();
            renderTimetable();
            renderHabits();
        }
    </script>
</body>
</html>
