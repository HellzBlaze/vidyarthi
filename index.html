<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vidyarthi - TimeTune Style</title>
    <style>
        :root {
            --primary: #6366f1; /* Indigo */
            --primary-soft: #e0e7ff;
            --accent: #f43f5e; /* Rose */
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --radius: 16px;
            --shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
            --timeline-line: #d1d5db;
        }

        [data-theme="dark"] {
            --bg: #111827;
            --card-bg: #1f2937;
            --text: #f9fafb;
            --text-light: #9ca3af;
            --border: #374151;
            --primary-soft: #312e81;
            --timeline-line: #4b5563;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body { background-color: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; transition: background 0.3s; }

        /* --- SIDEBAR --- */
        .sidebar { 
            width: 80px; background: var(--card-bg); display: flex; flex-direction: column; 
            border-right: 1px solid var(--border); z-index: 100; align-items: center; padding-top: 20px;
        }
        
        .nav-btn {
            background: none; border: none; width: 50px; height: 50px; border-radius: 14px; 
            color: var(--text-light); font-size: 1.5rem; margin-bottom: 15px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .nav-btn:hover { background: var(--bg); color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.4); }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; padding: 20px 30px; overflow-y: auto; scroll-behavior: smooth; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        h2 { font-size: 1.8rem; font-weight: 800; letter-spacing: -0.5px; }
        
        /* --- CARDS & UI --- */
        .section { display: none; animation: slideUp 0.3s ease; padding-bottom: 80px; }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 20px; }
        .btn { padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; }
        input, select { padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--bg); color: var(--text); outline: none; width: 100%; }

        /* --- TIMELINE STYLES (TimeTune Style) --- */
        .timeline-container { position: relative; padding-left: 20px; margin-top: 20px; }
        .timeline-container::before {
            content: ''; position: absolute; left: 29px; top: 0; bottom: 0; width: 2px; 
            background: var(--timeline-line); z-index: 0;
        }

        .timeline-block { 
            position: relative; margin-bottom: 20px; display: flex; align-items: flex-start; z-index: 1; 
            cursor: pointer; transition: transform 0.2s;
        }
        .timeline-block:active { transform: scale(0.98); }

        .time-col { width: 60px; font-size: 0.85rem; color: var(--text-light); text-align: right; padding-right: 15px; padding-top: 12px; font-weight: 600; }
        
        .icon-col { 
            width: 40px; height: 40px; border-radius: 50%; background: var(--card-bg); border: 2px solid var(--primary); 
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-right: 15px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); flex-shrink: 0;
        }

        .info-col { 
            flex: 1; background: var(--card-bg); padding: 15px; border-radius: 12px; 
            border: 1px solid var(--border); box-shadow: var(--shadow); 
        }

        .block-title { font-weight: 700; font-size: 1rem; margin-bottom: 4px; }
        .block-duration { font-size: 0.8rem; color: var(--text-light); }
        
        /* Highlight active block */
        .timeline-block.active .icon-col { background: var(--primary); color: white; border-color: var(--primary); animation: pulse 2s infinite; }
        .timeline-block.active .info-col { border-color: var(--primary); background: var(--primary-soft); }
        [data-theme="dark"] .timeline-block.active .info-col { background: #1e1b4b; } /* Dark theme active bg */

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); } 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); } }

        /* --- DASHBOARD WIDGETS --- */
        .now-widget { 
            background: linear-gradient(135deg, var(--primary), #818cf8); color: white; padding: 25px; 
            border-radius: 20px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;
        }
        .next-widget { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 15px; display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }

        /* --- TASK LIST --- */
        .task-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); }
        .task-check { width: 20px; height: 20px; border: 2px solid var(--text-light); border-radius: 6px; margin-right: 12px; cursor: pointer; }
        .task-check.checked { background: var(--accent); border-color: var(--accent); }

        /* --- MOBILE --- */
        @media (max-width: 768px) {
            body { flex-direction: column; height: 100vh; }
            .sidebar { 
                position: fixed; bottom: 0; left: 0; width: 100%; height: 65px;
                flex-direction: row; padding: 0; border-top: 1px solid var(--border); border-right: none;
                justify-content: space-around;
            }
            .nav-btn { width: auto; height: 100%; margin: 0; border-radius: 0; flex: 1; }
            .main-content { padding: 15px; margin-bottom: 65px; }
            .timeline-container::before { left: 19px; } /* Adjust line for mobile */
            .time-col { width: 40px; font-size: 0.75rem; text-align: left; }
            .icon-col { width: 32px; height: 32px; font-size: 1rem; margin-right: 10px; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div style="font-weight: 800; color: var(--primary); margin-bottom: 30px; font-size: 1.5rem;">V</div>
        <button class="nav-btn active" onclick="nav('dashboard')" title="Dashboard">üè†</button>
        <button class="nav-btn" onclick="nav('timeline')" title="Timeline">‚è±Ô∏è</button>
        <button class="nav-btn" onclick="nav('tasks')" title="To-Do">üìù</button>
        <button class="nav-btn" onclick="nav('focus')" title="Focus">üçÖ</button>
        <div style="flex:1"></div>
        <button class="nav-btn" onclick="toggleTheme()" title="Theme">üåó</button>
    </nav>

    <main class="main-content">
        
        <div class="header">
            <h2 id="page-title">Dashboard</h2>
            <div style="font-size: 0.9rem; font-weight: 600; color: var(--primary);" id="clock">00:00</div>
        </div>

        <section id="dashboard" class="section active">
            
            <div class="now-widget">
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 5px;">HAPPENING NOW</div>
                    <div style="font-size: 1.8rem; font-weight: 800;" id="now-title">Free Time</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">Until <span id="now-end">--:--</span></div>
                </div>
                <div style="font-size: 3rem;" id="now-icon">‚òï</div>
            </div>

            <div class="next-widget">
                <div style="font-weight: 700; color: var(--text-light); font-size: 0.8rem; writing-mode: vertical-rl; transform: rotate(180deg);">NEXT</div>
                <div style="width: 2px; height: 40px; background: var(--border);"></div>
                <div>
                    <div style="font-weight: 700;" id="next-title">Nothing planned</div>
                    <div style="font-size: 0.85rem; color: var(--text-light);" id="next-time">--:--</div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 15px;">Pending Tasks</h3>
                <div id="dash-tasks">
                    </div>
            </div>
        </section>

        <section id="timeline" class="section">
            
            <div class="card">
                <h3 style="margin-bottom: 15px;">Add Routine Block</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <input type="time" id="tl-start" required>
                    <input type="time" id="tl-end" required>
                </div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="tl-name" placeholder="Activity (e.g., Math Study)" style="flex: 2;">
                    <select id="tl-icon" style="flex: 1;">
                        <option value="üìö">üìö Study</option>
                        <option value="üèÉ">üèÉ Exercise</option>
                        <option value="ü•£">ü•£ Eat</option>
                        <option value="üéÆ">üéÆ Play</option>
                        <option value="üí§">üí§ Sleep</option>
                        <option value="üöå">üöå Travel</option>
                        <option value="üöø">üöø Routine</option>
                    </select>
                </div>
                <button class="btn" onclick="addBlock()" style="width: 100%; margin-top: 10px;">+ Add to Timeline</button>
            </div>

            <div class="timeline-container" id="timeline-list">
                </div>
            
            <div style="text-align: center; margin-top: 30px;">
                 <button onclick="clearTimeline()" style="color: var(--text-light); background: none; border: none; font-size: 0.8rem; cursor: pointer;">Clear Timeline</button>
            </div>
        </section>

        <section id="tasks" class="section">
            <div class="card" style="display: flex; gap: 10px;">
                <input type="text" id="task-input" placeholder="New Task...">
                <button class="btn" onclick="addTask()">Add</button>
            </div>
            <div class="card" id="task-list">
                </div>
        </section>

        <section id="focus" class="section">
            <div class="card" style="text-align: center; padding: 60px 20px;">
                <h3 style="color: var(--text-light); text-transform: uppercase; letter-spacing: 2px;">Focus Mode</h3>
                <div style="font-size: 5rem; font-weight: 800; color: var(--primary); margin: 30px 0; font-variant-numeric: tabular-nums;" id="timer-display">25:00</div>
                
                <div style="display: flex; justify-content: center; gap: 15px;">
                    <button class="btn" onclick="toggleTimer()" id="timer-btn" style="min-width: 100px;">Start</button>
                    <button class="btn" onclick="resetTimer()" style="background: var(--bg); color: var(--text);">Reset</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- DATA STORE ---
        // Timeline: Array of { id, name, start, end, icon }
        let timeline = JSON.parse(localStorage.getItem('vtTimeline')) || [
            { id: 1, name: "Morning Routine", start: "07:00", end: "08:00", icon: "üöø" },
            { id: 2, name: "School / Work", start: "09:00", end: "15:00", icon: "üöå" },
            { id: 3, name: "Homework", start: "16:00", end: "18:00", icon: "üìö" }
        ];
        
        let tasks = JSON.parse(localStorage.getItem('vtTasks')) || [];

        // --- INIT ---
        setInterval(updateClock, 1000);
        checkTheme();
        renderAll();

        // --- NAVIGATION ---
        function nav(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // Highlight Button
            const btn = Array.from(document.querySelectorAll('.nav-btn')).find(b => b.onclick.toString().includes(id));
            if(btn) btn.classList.add('active');

            const titles = {dashboard: 'Dashboard', timeline: 'My Day', tasks: 'Tasks', focus: 'Focus'};
            document.getElementById('page-title').innerText = titles[id];
        }

        // --- TIMELINE LOGIC ---
        function addBlock() {
            const start = document.getElementById('tl-start').value;
            const end = document.getElementById('tl-end').value;
            const name = document.getElementById('tl-name').value;
            const icon = document.getElementById('tl-icon').value;

            if(!start || !end || !name) return alert("Fill all fields");
            if(start >= end) return alert("End time must be after start time");

            timeline.push({ id: Date.now(), name, start, end, icon });
            saveTimeline();
            
            // Clear inputs
            document.getElementById('tl-name').value = '';
        }

        function deleteBlock(id) {
            if(confirm("Remove this block?")) {
                timeline = timeline.filter(t => t.id !== id);
                saveTimeline();
            }
        }

        function saveTimeline() {
            localStorage.setItem('vtTimeline', JSON.stringify(timeline));
            renderTimeline();
            updateDashboard();
        }

        function clearTimeline() {
            if(confirm("Delete entire routine?")) {
                timeline = [];
                saveTimeline();
            }
        }

        function renderTimeline() {
            const container = document.getElementById('timeline-list');
            container.innerHTML = '';

            // Sort by start time
            timeline.sort((a, b) => a.start.localeCompare(b.start));

            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

            timeline.forEach(block => {
                // Check if active
                const isActive = (currentTime >= block.start && currentTime < block.end);
                
                const html = `
                    <div class="timeline-block ${isActive ? 'active' : ''}">
                        <div class="time-col">${block.start}</div>
                        <div class="icon-col">${block.icon}</div>
                        <div class="info-col">
                            <div style="display:flex; justify-content:space-between;">
                                <div class="block-title">${block.name}</div>
                                <button onclick="deleteBlock(${block.id})" style="background:none; border:none; color:var(--text-light); cursor:pointer;">&times;</button>
                            </div>
                            <div class="block-duration">${block.start} - ${block.end}</div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // --- DASHBOARD LOGIC ---
        function updateDashboard() {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

            // Find Current
            const currentBlock = timeline.find(b => currentTime >= b.start && currentTime < b.end);
            
            if (currentBlock) {
                document.getElementById('now-title').innerText = currentBlock.name;
                document.getElementById('now-end').innerText = currentBlock.end;
                document.getElementById('now-icon').innerText = currentBlock.icon;
            } else {
                document.getElementById('now-title').innerText = "Free Time";
                document.getElementById('now-end').innerText = "--:--";
                document.getElementById('now-icon').innerText = "‚òï";
            }

            // Find Next
            // Filter blocks that start after current time, sort, pick first
            const upcoming = timeline.filter(b => b.start > currentTime).sort((a,b) => a.start.localeCompare(b.start));
            
            if (upcoming.length > 0) {
                document.getElementById('next-title').innerText = upcoming[0].name;
                document.getElementById('next-time').innerText = upcoming[0].start;
            } else {
                document.getElementById('next-title').innerText = "No upcoming blocks";
                document.getElementById('next-time').innerText = "--:--";
            }

            // Render Tasks in Dashboard
            const dashTaskContainer = document.getElementById('dash-tasks');
            dashTaskContainer.innerHTML = '';
            const pendingTasks = tasks.filter(t => !t.done).slice(0, 3); // Show top 3
            
            if(pendingTasks.length === 0) {
                dashTaskContainer.innerHTML = '<div style="color:var(--text-light); font-size:0.9rem;">No pending tasks. Great job!</div>';
            } else {
                pendingTasks.forEach(t => {
                    dashTaskContainer.innerHTML += `
                        <div style="padding:10px 0; border-bottom:1px solid var(--border); display:flex; gap:10px; align-items:center;">
                            <div style="width:10px; height:10px; background:var(--accent); border-radius:50%;"></div>
                            <span>${t.text}</span>
                        </div>`;
                });
            }
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            // Refresh dashboard highlights every minute
            if(now.getSeconds() === 0) renderTimeline();
        }

        // --- TASKS LOGIC ---
        function addTask() {
            const input = document.getElementById('task-input');
            if(!input.value) return;
            tasks.push({ id: Date.now(), text: input.value, done: false });
            input.value = '';
            saveTasks();
        }

        function toggleTask(id) {
            const t = tasks.find(x => x.id === id);
            if(t) t.done = !t.done;
            saveTasks();
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            saveTasks();
        }

        function saveTasks() {
            localStorage.setItem('vtTasks', JSON.stringify(tasks));
            renderTasks();
            updateDashboard();
        }

        function renderTasks() {
            const container = document.getElementById('task-list');
            container.innerHTML = '';
            
            tasks.sort((a,b) => a.done === b.done ? 0 : a.done ? 1 : -1); // Done items at bottom

            tasks.forEach(t => {
                container.innerHTML += `
                    <div class="task-item" style="opacity: ${t.done ? 0.5 : 1}">
                        <div class="task-check ${t.done ? 'checked' : ''}" onclick="toggleTask(${t.id})"></div>
                        <div style="flex:1; text-decoration: ${t.done ? 'line-through' : 'none'}">${t.text}</div>
                        <button onclick="deleteTask(${t.id})" style="background:none; border:none; color:var(--text-light); font-size:1.2rem; cursor:pointer;">&times;</button>
                    </div>
                `;
            });
        }

        // --- TIMER LOGIC ---
        let timer = null;
        let timeLeft = 1500;
        function toggleTimer() {
            const btn = document.getElementById('timer-btn');
            if(timer) {
                clearInterval(timer); timer = null;
                btn.innerText = "Start";
            } else {
                timer = setInterval(() => {
                    timeLeft--;
                    const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
                    const s = (timeLeft%60).toString().padStart(2,'0');
                    document.getElementById('timer-display').innerText = `${m}:${s}`;
                    if(timeLeft <= 0) resetTimer();
                }, 1000);
                btn.innerText = "Pause";
            }
        }
        function resetTimer() {
            clearInterval(timer); timer = null; timeLeft = 1500;
            document.getElementById('timer-display').innerText = "25:00";
            document.getElementById('timer-btn').innerText = "Start";
        }

        // --- THEME ---
        function toggleTheme() {
            if(document.body.getAttribute('data-theme') === 'dark') {
                document.body.removeAttribute('data-theme');
                localStorage.setItem('vtTheme', 'light');
            } else {
                document.body.setAttribute('data-theme', 'dark');
                localStorage.setItem('vtTheme', 'dark');
            }
        }
        function checkTheme() {
            if(localStorage.getItem('vtTheme') === 'dark') document.body.setAttribute('data-theme', 'dark');
        }

        // --- INITIAL RENDER ---
        function renderAll() {
            renderTimeline();
            renderTasks();
            updateDashboard();
        }
    </script>
</body>
</html>
